<!-- templates/navbar.html (FINAL sesuai arahan) -->
<nav class="fixed inset-x-0 top-0 z-50 bg-white/90 backdrop-blur border-b border-neutral-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16">
    <div class="flex h-full items-center justify-between">

      <!-- Brand / Home: pakai logo asli proyek -->
      <a href="{{ url_for('dashboard') }}" class="flex items-center gap-2">
        <img src="{{ url_for('static', filename='img/logo.PNG') }}" alt="ARV LOGAM" class="h-8 w-auto"/>
        <span class="font-semibold tracking-wide text-neutral-900">ARV LOGAM</span>
      </a>

      <!-- Desktop -->
      <div class="hidden md:flex items-center gap-6">
        {% set _role = role|default('user') %}

        {% if _role == 'admin' %}
          <!-- ====== MENU ADMIN (tombol tunggal + dropdown) ====== -->
          <div class="relative" id="adminDropdown">
            <button type="button"
                    class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-neutral-300 hover:bg-neutral-50">
              <!-- icon badge/star-cog -->
              <svg class="h-5 w-5 text-red-600" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 2l2.1 3.6 4.1.7-2.9 3 0.7 4.2L12 12.8 8 13.5l0.7-4.2-2.9-3 4.1-.7L12 2z"/>
                <circle cx="19" cy="5" r="0" fill="none"/>
              </svg>
              <span class="font-medium">Admin</span>
              <svg class="h-4 w-4 text-neutral-500" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"/></svg>
            </button>

            <!-- Panel dropdown admin -->
            <div class="absolute right-0 mt-2 w-60 rounded-xl border border-neutral-200 bg-white shadow-xl hidden">
              <a href="{{ url_for('dashboard') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
                <!-- home -->
                <svg class="h-5 w-5 text-neutral-700" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"/></svg>
                <span>Dashboard</span>
              </a>
              <a href="{{ url_for('addBarang') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
                <!-- plus-square -->
                <svg class="h-5 w-5 text-emerald-600" viewBox="0 0 24 24" fill="currentColor"><path d="M4 3h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm7 5v4H7v2h4v4h2v-4h4v-2h-4V8h-2z"/></svg>
                <span>Tambah Barang</span>
              </a>
              <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
                <!-- users-gear -->
                <svg class="h-5 w-5 text-violet-600" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3ZM8 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3Zm0 2c-3 0-7 1.5-7 4v2h8.5a5.5 5.5 0 0 1 0-6H8Zm9 0a4 4 0 1 1-3.46 6h-.04a4 4 0 0 1 3.5-6z"/></svg>
                <span>Kelola User</span>
              </a>
              <a href="{{ url_for('admin_orders') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
                <!-- list-check -->
                <svg class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="currentColor"><path d="M4 7h9v2H4V7zm0 5h9v2H4v-2zm0 5h9v2H4v-2zm12-9 2 2 3-3-1.4-1.4L16 10.2l-.6-.6L14 11l2 2z"/></svg>
                <span>Kelola Pesanan</span>
              </a>
            </div>
          </div>
        {% else %}
          <!-- ====== MENU USER (tetap seperti biasa) ====== -->
          <a href="{{ url_for('dashboard') }}" class="text-sm text-neutral-700 hover:text-red-600">Dashboard</a>
          <a href="{{ url_for('cart_view') }}" class="text-sm text-neutral-700 hover:text-red-600">
            Keranjang{% if cart_count %} ({{ cart_count }}){% endif %}
          </a>
          <a href="{{ url_for('orders_me') }}" class="text-sm text-neutral-700 hover:text-red-600">Pesanan Saya</a>
        {% endif %}

        <!-- ====== PROFIL (ikon + dropdown berisi Profil & Keluar) ====== -->
        <div class="relative" id="profileDropdown">
          <button type="button" class="inline-flex items-center gap-2 px-3 py-2 rounded-full border border-neutral-300 hover:bg-neutral-50">
            <!-- user-circle -->
            <svg class="h-5 w-5 text-neutral-700" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm0 5a3 3 0 1 1-3 3 3 3 0 0 1 3-3Zm0 12a7 7 0 0 1-5.65-2.83 5 5 0 0 1 11.3 0A7 7 0 0 1 12 19Z"/></svg>
            <span class="hidden lg:inline text-sm text-neutral-700">Halo, {{ nama|default('Pengguna') }}</span>
            <svg class="h-4 w-4 text-neutral-500" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"/></svg>
          </button>
          <div class="absolute right-0 mt-2 w-56 rounded-xl border border-neutral-200 bg-white shadow-xl overflow-hidden hidden">
            <a href="{{ url_for('editProfile') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
              <!-- id-card -->
              <svg class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="currentColor"><path d="M3 5h18a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3h6v2H7V8zm0 3h6v2H7v-2zm10 4a3 3 0 1 0-6 0h6z"/></svg>
              <span>Profil</span>
            </a>
            <a href="{{ url_for('logout') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50 text-red-600">
              <!-- power/logout -->
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M16 13v-2H8V8l-5 4 5 4v-3h8zm3 7H11a2 2 0 0 1-2-2v-3h2v3h8V6h-8v3H9V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/></svg>
              <span>Keluar</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile: hamburger -->
      <button class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg border border-neutral-300 hover:bg-neutral-50"
              aria-label="Menu" id="btnMobile">
        <svg class="h-5 w-5 text-neutral-700" viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"/></svg>
      </button>
    </div>
  </div>

  <!-- Mobile panel -->
  <div id="mobilePanel" class="md:hidden hidden border-t border-neutral-200 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex flex-col gap-1">
      {% if _role == 'admin' %}
        <details class="rounded-lg">
          <summary class="px-2 py-2 rounded-lg hover:bg-neutral-50 cursor-pointer inline-flex items-center gap-2">
            <svg class="h-5 w-5 text-red-600" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l2.1 3.6 4.1.7-2.9 3 0.7 4.2L12 12.8 8 13.5l0.7-4.2-2.9-3 4.1-.7L12 2z"/></svg>
            <span>Admin</span>
          </summary>
          <div class="pl-8 pr-2 py-1 flex flex-col">
            <a href="{{ url_for('dashboard') }}" class="px-2 py-2 rounded hover:bg-neutral-50">Dashboard</a>
            <a href="{{ url_for('addBarang') }}" class="px-2 py-2 rounded hover:bg-neutral-50">Tambah Barang</a>
            <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}" class="px-2 py-2 rounded hover:bg-neutral-50">Kelola User</a>
            <a href="{{ url_for('admin_orders') }}" class="px-2 py-2 rounded hover:bg-neutral-50">Kelola Pesanan</a>
          </div>
        </details>
      {% else %}
        <a href="{{ url_for('dashboard') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Dashboard</a>
        <a href="{{ url_for('cart_view') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">
          Keranjang{% if cart_count %} ({{ cart_count }}){% endif %}
        </a>
        <a href="{{ url_for('orders_me') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Pesanan Saya</a>
      {% endif %}
      <div class="h-px bg-neutral-200 my-2"></div>
      <a href="{{ url_for('editProfile') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Profil</a>
      <a href="{{ url_for('logout') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50 text-red-600">Keluar</a>
    </div>
  </div>
</nav>

<!-- spacer agar konten tidak ketutup navbar fixed -->
<div class="h-16"></div>

<script>
  // Admin dropdown (desktop)
  (function () {
    const root = document.getElementById('adminDropdown');
    if (!root) return;
    const btn = root.querySelector('button');
    const panel = root.querySelector('div.absolute');
    btn.addEventListener('click', () => panel.classList.toggle('hidden'));
    document.addEventListener('click', (e) => {
      if (!root.contains(e.target)) panel.classList.add('hidden');
    });
  })();

  // Profile dropdown (desktop)
  (function () {
    const root = document.getElementById('profileDropdown');
    if (!root) return;
    const btn = root.querySelector('button');
    const panel = root.querySelector('div.absolute');
    btn.addEventListener('click', () => panel.classList.toggle('hidden'));
    document.addEventListener('click', (e) => {
      if (!root.contains(e.target)) panel.classList.add('hidden');
    });
  })();

  // Mobile menu
  (function () {
    const btn = document.getElementById('btnMobile');
    const panel = document.getElementById('mobilePanel');
    if (!btn || !panel) return;
    btn.addEventListener('click', () => panel.classList.toggle('hidden'));
    document.addEventListener('click', (e) => {
      const within = btn.contains(e.target) || panel.contains(e.target);
      if (!within) panel.classList.add('hidden');
    });
  })();
</script>
