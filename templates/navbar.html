
{% set DEFAULT_AVATAR = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><defs/><circle cx="32" cy="32" r="32" fill="%23e5e7eb"/><circle cx="32" cy="26" r="12" fill="%23cbd5e1"/><path d="M12 54c4-10 36-10 40 0" fill="%23cbd5e1"/></svg>' %}

<img
  src="{{ avatar_url or DEFAULT_AVATAR }}"
  alt="Profil"
  class="h-8 w-8 rounded-full object-cover border border-neutral-300"
  onerror="this.onerror=null;this.src='{{ DEFAULT_AVATAR }}';"
/>

<!-- templates/navbar.html -->
<nav class="fixed inset-x-0 top-0 z-50 bg-white/90 backdrop-blur border-b border-neutral-200">
  <!-- (Opsional) CDN ikon; aman dipakai lokal di layout navbar saja -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16">
    <div class="flex h-full items-center justify-between">

      <!-- Brand / Logo -->
      <a href="{{ url_for('dashboard') }}" class="flex items-center gap-2">
        <img src="{{ url_for('static', filename='img/logo.PNG') }}" alt="Logo" class="h-8 w-auto"/>
      </a>

      <!-- ===== DESKTOP (>= md) ===== -->
      <div class="hidden md:flex items-center gap-6">
        {% set _role = role|default('user') %}

        {% if _role == 'admin' %}
          <!-- Admin dropdown (desktop) -->
          <div class="relative" id="adminDesktop">
            <button type="button"
                    class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-green-600 text-white hover:bg-green-700">
              <i class="fa-solid fa-gear"></i>
              <span class="font-medium">Admin</span>
              <i class="fa-solid fa-caret-down"></i>
            </button>
            <div class="absolute right-0 mt-2 w-60 rounded-xl border border-neutral-200 bg-white shadow-xl hidden">
              <a href="{{ url_for('dashboard') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50"><i class="fa-solid fa-house text-neutral-700"></i><span>Dashboard</span></a>
              <a href="{{ url_for('addBarang') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50"><i class="fa-solid fa-square-plus text-emerald-600"></i><span>Tambah Barang</span></a>
              <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50"><i class="fa-solid fa-users-gear text-violet-600"></i><span>Kelola User</span></a>
              <a href="{{ url_for('admin_orders') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50"><i class="fa-solid fa-list-check text-blue-600"></i><span>Kelola Pesanan</span></a>
            </div>
          </div>
        {% else %}
          <!-- Menu user (desktop) -->
          <a href="{{ url_for('dashboard') }}" class="text-sm text-neutral-700 hover:text-red-600">Dashboard</a>
          <a href="{{ url_for('cart_view') }}" class="text-sm text-neutral-700 hover:text-red-600">Keranjang{% if cart_count %} ({{ cart_count }}){% endif %}</a>
          <a href="{{ url_for('orders_me') }}" class="text-sm text-neutral-700 hover:text-red-600">Pesanan Saya</a>
        {% endif %}

        <!-- Profile dropdown (desktop) -->
        {% set _avatar = avatar_url if avatar_url else url_for('static', filename='img/no-image.png') %}
        <div class="relative" id="profileDesktop">
          <button type="button" class="inline-flex items-center gap-2 pl-2 pr-3 py-2 rounded-full border border-neutral-300 hover:bg-neutral-50">
            <img src="{{ _avatar }}" alt="avatar" class="h-7 w-7 rounded-full object-cover" onerror="this.src='{{ url_for('static', filename='img/no-image.png') }}'">
            <span class="hidden lg:inline text-sm text-neutral-700">Halo, {{ nama|default('Pengguna') }}</span>
            <i class="fa-solid fa-caret-down text-neutral-500"></i>
          </button>
          <div class="absolute right-0 mt-2 w-56 rounded-xl border border-neutral-200 bg-white shadow-xl overflow-hidden hidden">
            <a href="{{ url_for('editProfile') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50"><i class="fa-solid fa-id-card text-blue-600"></i><span>Profil</span></a>
            <a href="{{ url_for('logout') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50 text-red-600"><i class="fa-solid fa-right-from-bracket"></i><span>Keluar</span></a>
          </div>
        </div>
      </div>

      <!-- ===== MOBILE (< md) ===== -->
      <div class="md:hidden flex items-center gap-2">
        {% set _role_m = role|default('user') %}
        {% set NOIMG = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="320" height="240"><rect width="100%25" height="100%25" fill="%23f1f5f9"/><g fill="%2394a3b8"><rect x="40" y="60" width="240" height="120" rx="12" ry="12" fill="%23e2e8f0"/><path d="M80 150l40-40 30 30 40-50 30 40" fill="none" stroke="%2394a3b8" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></g></svg>' %}

        {% if _role_m == 'admin' %}
          <!-- KIRI: tombol Admin (gear) -->
          <div class="relative" id="adminMobile">
            <button class="h-9 w-9 inline-flex items-center justify-center rounded-lg bg-green-600 text-white hover:bg-green-700" aria-label="Menu admin">
              <i class="fa-solid fa-gear"></i>
            </button>
            <div class="absolute right-0 mt-2 w-56 rounded-xl border border-neutral-200 bg-white shadow-xl hidden">
              <a href="{{ url_for('dashboard') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-house mr-2"></i>Dashboard</a>
              <a href="{{ url_for('addBarang') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-square-plus mr-2"></i>Tambah Barang</a>
              <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-users-gear mr-2"></i>Kelola User</a>
              <a href="{{ url_for('admin_orders') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-list-check mr-2"></i>Kelola Pesanan</a>
            </div>
          </div>
        {% else %}
          <!-- KIRI: hamburger untuk user -->
          <div class="relative" id="userMobileMenu">
            <button class="h-9 w-9 inline-flex items-center justify-center rounded-lg border border-neutral-300 hover:bg-neutral-100" aria-label="Menu">
              <i class="fa-solid fa-bars"></i>
            </button>
            <div class="absolute right-0 mt-2 w-56 rounded-xl border border-neutral-200 bg-white shadow-xl hidden">
              <a href="{{ url_for('dashboard') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-house mr-2"></i>Dashboard</a>
              <a href="{{ url_for('cart_view') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-cart-shopping mr-2"></i>Keranjang{% if cart_count %} ({{ cart_count }}){% endif %}</a>
              <a href="{{ url_for('orders_me') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-receipt mr-2"></i>Pesanan Saya</a>
            </div>
          </div>
        {% endif %}

        <!-- KANAN: Avatar (profil & keluar) -->
        <div class="relative" id="profileMobile">
          <button class="h-9 w-9 rounded-full border border-neutral-300 overflow-hidden" aria-label="Profil">
            <img onerror="this.onerror=null;this.src='{{ NOIMG }}';">
          </button>
          <div class="absolute right-0 mt-2 w-56 rounded-xl border border-neutral-200 bg-white shadow-xl hidden">
            <a href="{{ url_for('editProfile') }}" class="block px-4 py-2 hover:bg-neutral-50"><i class="fa-solid fa-id-card mr-2"></i>Profil</a>
            <a href="{{ url_for('logout') }}" class="block px-4 py-2 hover:bg-neutral-50 text-red-600"><i class="fa-solid fa-right-from-bracket mr-2"></i>Keluar</a>
          </div>
        </div>
      </div>
      <!-- /MOBILE -->
    </div>
  </div>
</nav>

<!-- spacer agar konten tidak ketutup navbar -->
<div class="h-16"></div>

<script>
  // util untuk dropdown
  function bindDropdown(rootId){
    const root=document.getElementById(rootId);
    if(!root) return;
    const btn=root.querySelector('button');
    const panel=root.querySelector('div.absolute');
    btn.addEventListener('click',()=>panel.classList.toggle('hidden'));
    document.addEventListener('click',(e)=>{ if(!root.contains(e.target)) panel.classList.add('hidden'); });
  }
  // desktop
  bindDropdown('adminDesktop');
  bindDropdown('profileDesktop');
  // mobile
  bindDropdown('adminMobile');
  bindDropdown('userMobileMenu');
  bindDropdown('profileMobile');
</script>
