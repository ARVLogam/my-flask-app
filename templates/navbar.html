<!-- templates/navbar.html -->
<header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-neutral-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center gap-3">

    <!-- Logo -->
    <a href="{{ url_for('dashboard') }}" class="shrink-0">
      <img src="{{ url_for('static', filename='img/logo.PNG') }}" alt="Logo" class="h-8 w-auto" />
    </a>

    <!-- Search (opsional) -->
    <form action="#" class="relative flex-1 max-w-2xl hidden sm:block">
      <input
        type="search"
        placeholder="Cari produk..."
        class="w-full rounded-2xl border border-neutral-300 bg-white py-2.5 pl-10 pr-4 text-sm
               focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" />
      <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m21 21-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"/>
      </svg>
    </form>

    <div class="flex items-center gap-3 ml-auto">

      {# === TOMBOL ADMIN (khusus role admin) === #}
      {% if role == 'admin' %}
      <div class="relative" data-admin-menu>
        <button type="button" id="btnAdmin"
                class="inline-flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-xl hover:bg-red-700">
          <i class="fa-solid fa-bars"></i>
          <span>Admin</span>
        </button>

        <!-- Dropdown Admin -->
        <div id="menuAdmin"
             class="hidden absolute right-0 mt-2 w-56 rounded-2xl border border-neutral-200 bg-white shadow-xl overflow-hidden">
          <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}"
             class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
            <i class="fa-solid fa-users text-violet-600"></i>
            <span>Kelola User</span>
          </a>
        </div>
      </div>
      {% endif %}

      <!-- MENU USER -->
      <div class="relative" data-user-menu>
        <button type="button" id="btnUser"
                class="inline-flex items-center gap-3 px-4 py-2 rounded-2xl border border-neutral-300 bg-white hover:bg-neutral-100">
          <span class="hidden sm:block text-sm text-neutral-700">Halo, {{ nama }}</span>

          {# Avatar: coba user_<id>.webp, kalau gagal pakai guest.png #}
          <img
            src="{{ url_for('static', filename='img/avatars/user_' ~ session.get('user_id') ~ '.webp') }}?v={{ range(1,1000000)|random }}"
            onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/avatars/guest.png') }}';"
            alt="avatar"
            class="h-7 w-7 rounded-full object-cover border" />
        </button>

        <div id="menuUser"
             class="hidden absolute right-0 mt-2 w-56 rounded-2xl border border-neutral-200 bg-white shadow-xl overflow-hidden">
          <a href="{{ url_for('editProfile') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50">
            <i class="fa-solid fa-user-pen text-blue-600"></i>
            <span>Edit Profil</span>
          </a>
          <a href="{{ url_for('logout') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50 text-red-600">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>Keluar</span>
          </a>
        </div>
      </div>

    </div>
  </div>
</header>

<script>
  // Toggle & auto-close dropdown
  (function () {
    const adminBtn  = document.getElementById('btnAdmin');
    const adminMenu = document.getElementById('menuAdmin');
    const userBtn   = document.getElementById('btnUser');
    const userMenu  = document.getElementById('menuUser');

    const hideAll = () => {
      adminMenu && adminMenu.classList.add('hidden');
      userMenu  && userMenu.classList.add('hidden');
    };

    adminBtn && adminBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      adminMenu.classList.toggle('hidden');
      userMenu && userMenu.classList.add('hidden');
    });

    userBtn && userBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      userMenu.classList.toggle('hidden');
      adminMenu && adminMenu.classList.add('hidden');
    });

    document.addEventListener('click', (e) => {
      const inAdmin = e.target.closest('[data-admin-menu]');
      const inUser  = e.target.closest('[data-user-menu]');
      if (!inAdmin && !inUser) hideAll();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') hideAll();
    });
  })();
</script>
