<!-- templates/navbar.html (FINAL) -->
<nav class="fixed inset-x-0 top-0 z-50 bg-white/90 backdrop-blur border-b border-neutral-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16">
    <div class="flex h-full items-center justify-between">

      <!-- Brand / Home -->
      <a href="{{ url_for('dashboard') }}" class="flex items-center gap-2">
        <svg class="h-6 w-6 text-red-600" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M3 12h18v2H3v-2Zm0-6h18v2H3V6Zm0 12h18v2H3v-2Z"/>
        </svg>
        <span class="font-semibold tracking-wide text-neutral-900">ARV LOGAM</span>
      </a>

      <!-- Desktop menu -->
      <div class="hidden md:flex items-center gap-6">
        {% set _role = role|default('user') %}

        {% if _role == 'admin' %}
          <a href="{{ url_for('dashboard') }}" class="text-sm text-neutral-700 hover:text-red-600">Dashboard</a>
          <a href="{{ url_for('addBarang') }}" class="text-sm text-neutral-700 hover:text-red-600">Tambah Barang</a>
          <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}" class="text-sm text-neutral-700 hover:text-red-600">Kelola User</a>
          <a href="{{ url_for('admin_orders') }}" class="text-sm text-neutral-700 hover:text-red-600">Kelola Pesanan</a>
        {% else %}
          <a href="{{ url_for('dashboard') }}" class="text-sm text-neutral-700 hover:text-red-600">Dashboard</a>
          <a href="{{ url_for('cart_view') }}" class="text-sm text-neutral-700 hover:text-red-600">
            Keranjang{% if cart_count %} ({{ cart_count }}){% endif %}
          </a>
          <a href="{{ url_for('orders_me') }}" class="text-sm text-neutral-700 hover:text-red-600">Pesanan Saya</a>
        {% endif %}

        <!-- Profil dropdown -->
        <div class="relative" id="profileDropdown">
          <button type="button" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-neutral-300 hover:bg-neutral-50">
            {% set _avatar = avatar_url if avatar_url else url_for('static', filename='img/avatars/guest.png') %}
            <img src="{{ _avatar }}" alt="avatar" class="h-7 w-7 rounded-full object-cover border">
            <span class="text-sm text-neutral-700 hidden lg:inline">Halo, {{ nama|default('Pengguna') }}</span>
            <svg class="h-4 w-4 text-neutral-500" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"/></svg>
          </button>
          <div class="absolute right-0 mt-2 w-56 rounded-xl border border-neutral-200 bg-white shadow-xl overflow-hidden hidden">
            <a href="{{ url_for('editProfile') }}" class="block px-4 py-3 text-sm hover:bg-neutral-50">Profil</a>
            <a href="{{ url_for('logout') }}" class="block px-4 py-3 text-sm text-red-600 hover:bg-neutral-50">Keluar</a>
          </div>
        </div>
      </div>

      <!-- Mobile: hamburger -->
      <button class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg border border-neutral-300 hover:bg-neutral-50"
              aria-label="Menu" id="btnMobile">
        <svg class="h-5 w-5 text-neutral-700" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu panel -->
  <div id="mobilePanel" class="md:hidden hidden border-t border-neutral-200 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex flex-col gap-1">
      {% if _role == 'admin' %}
        <a href="{{ url_for('dashboard') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Dashboard</a>
        <a href="{{ url_for('addBarang') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Tambah Barang</a>
        <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Kelola User</a>
        <a href="{{ url_for('admin_orders') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Kelola Pesanan</a>
      {% else %}
        <a href="{{ url_for('dashboard') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Dashboard</a>
        <a href="{{ url_for('cart_view') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">
          Keranjang{% if cart_count %} ({{ cart_count }}){% endif %}
        </a>
        <a href="{{ url_for('orders_me') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Pesanan Saya</a>
      {% endif %}
      <div class="h-px bg-neutral-200 my-2"></div>
      <a href="{{ url_for('editProfile') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50">Profil</a>
      <a href="{{ url_for('logout') }}" class="px-2 py-2 rounded-lg hover:bg-neutral-50 text-red-600">Keluar</a>
    </div>
  </div>
</nav>

<!-- spacer agar konten tidak ketutup navbar fixed -->
<div class="h-16"></div>

<script>
  // Dropdown profil (desktop)
  (function () {
    const root = document.getElementById('profileDropdown');
    if (!root) return;
    const btn = root.querySelector('button');
    const panel = root.querySelector('div.absolute');
    btn.addEventListener('click', () => panel.classList.toggle('hidden'));
    document.addEventListener('click', (e) => {
      if (!root.contains(e.target)) panel.classList.add('hidden');
    });
  })();

  // Mobile menu
  (function () {
    const btn = document.getElementById('btnMobile');
    const panel = document.getElementById('mobilePanel');
    if (!btn || !panel) return;
    btn.addEventListener('click', () => panel.classList.toggle('hidden'));
    document.addEventListener('click', (e) => {
      const within = btn.contains(e.target) || panel.contains(e.target);
      if (!within) panel.classList.add('hidden');
    });
  })();
</script>
