<!-- templates/navbar.html -->
<header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-neutral-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center gap-3">
    <!-- Logo -->
    <a href="{{ url_for('dashboard') }}" class="shrink-0">
      <img src="{{ url_for('static', filename='img/logo.PNG') }}" alt="Logo" class="h-8 w-auto">
    </a>

    <!-- Search (opsional) -->
    <form action="#" class="relative flex-1 max-w-2xl hidden sm:block">
      <input type="search" placeholder="Cari produk..."
             class="w-full rounded-2xl border border-neutral-300 bg-white py-2.5 pl-10 pr-4 text-sm
                    focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500">
      <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m21 21-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"/>
      </svg>
    </form>

    <div class="flex items-center gap-3 ml-auto">
      {# ===== TOMBOL ADMIN (khusus admin) ===== #}
      {% if (role|default('')) == 'admin' %}
      <div class="relative" data-admin-menu>
        <button type="button" id="btnAdmin"
                class="inline-flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-xl hover:bg-red-700">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M3 6h18v2H3V6zm0 5.5h18v2H3v-2zM3 17h18v2H3v-2z"/>
          </svg>
          <span>Admin</span>
        </button>

        <div id="menuAdmin"
             class="hidden absolute right-0 mt-2 w-56 rounded-2xl border border-neutral-200 bg-white shadow-xl overflow-hidden z-50">
          <a href="{{ url_for('menuAdmin', roleMenu='kelolaUser') }}"
             class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50 nav-close">
            <svg class="h-5 w-5 text-violet-600" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
            </svg>
            <span>Kelola User</span>
          </a>
        </div>
      </div>
      {% endif %}

      <!-- MENU USER -->
      <div class="relative" data-user-menu>
        <button type="button" id="btnUser"
                class="inline-flex items-center gap-3 px-4 py-2 rounded-2xl border border-neutral-300 bg-white hover:bg-neutral-100">
          <span class="hidden sm:block text-sm text-neutral-700">Halo, {{ nama|default('Pengguna') }}</span>

          {# avatar_url DIKIRIM dari route; fallback guest #}
          {% set _avatar = avatar_url if avatar_url else url_for('static', filename='img/avatars/guest.png') %}
          <img src="{{ _avatar }}" alt="avatar" class="h-7 w-7 rounded-full object-cover border">
        </button>

        <div id="menuUser"
             class="hidden absolute right-0 mt-2 w-56 rounded-2xl border border-neutral-200 bg-white shadow-xl overflow-hidden z-50">
          <a href="{{ url_for('editProfile') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50 nav-close">
            <svg class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4S8 5.79 8 8s1.79 4 4 4zm-6 8v-1c0-2.21 3.58-4 8-4s8 1.79 8 4v1H6z"/>
            </svg>
            <span>Edit Profil</span>
          </a>
          <a href="{{ url_for('logout') }}" class="flex items-center gap-3 px-4 py-3 hover:bg-neutral-50 text-red-600 nav-close">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M16 13v-2H7V8l-5 4 5 4v-3h9zm3 7H11a2 2 0 0 1-2-2v-3h2v3h8V6h-8v3H9V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/>
            </svg>
            <span>Keluar</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  (function () {
    const adminBtn  = document.getElementById('btnAdmin');
    const adminMenu = document.getElementById('menuAdmin');
    const userBtn   = document.getElementById('btnUser');
    const userMenu  = document.getElementById('menuUser');

    const hideAll = () => {
      adminMenu && adminMenu.classList.add('hidden');
      userMenu  && userMenu.classList.add('hidden');
    };

    adminBtn && adminBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      adminMenu.classList.toggle('hidden');
      userMenu && userMenu.classList.add('hidden');
    });

    userBtn && userBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      userMenu.classList.toggle('hidden');
      adminMenu && adminMenu.classList.add('hidden');
    });

    document.addEventListener('click', (e) => {
      const inAdmin = e.target.closest('[data-admin-menu]');
      const inUser  = e.target.closest('[data-user-menu]');
      if (!inAdmin && !inUser) hideAll();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') hideAll();
    });

    document.querySelectorAll('.nav-close').forEach(a => {
      a.addEventListener('click', () => hideAll());
    });
  })();
</script>
