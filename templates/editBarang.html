<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Barang</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
</head>
<body class="bg-neutral-100 min-h-screen py-8">
  {% include 'flashProtection.html' %}
  <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
    <div class="bg-red-600 py-5 px-6">
      <h1 class="text-2xl font-bold text-white text-center">Edit Barang</h1>
    </div>

    <form method="POST"
          action="{{ url_for('editBarang', id_barang=barang[0]) }}"
          enctype="multipart/form-data"
          class="p-6 space-y-5">

      <!-- Nama -->
      <div>
        <label for="nama_barang" class="block text-sm font-medium text-neutral-700 mb-1">Nama Barang</label>
        <div class="relative">
          <i class="fa-solid fa-box absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"></i>
          <input type="text" id="nama_barang" name="nama_barang"
                 class="w-full pl-10 pr-3 py-2 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                 required placeholder="Masukkan nama barang"
                 value="{{ barang[1] if barang else '' }}" />
        </div>
      </div>

      <!-- Harga -->
      <div>
        <label for="harga" class="block text-sm font-medium text-neutral-700 mb-1">Harga</label>
        <div class="relative">
          <i class="fa-solid fa-tag absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"></i>
          <input type="text" inputmode="decimal" id="harga" name="harga"
                 class="w-full pl-10 pr-3 py-2 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                 value="{{ '{:,.2f}'.format(barang[2]).replace(',', '.') if barang else '' }}"
                 placeholder="cth 150000" required />
        </div>
        <p class="text-xs text-neutral-500 mt-1">Masukkan angka saja. Koma/ titik akan dinormalisasi.</p>
      </div>

      <!-- Deskripsi -->
      <div>
        <label for="deskripsi" class="block text-sm font-medium text-neutral-700 mb-1">Deskripsi</label>
        <div class="relative">
          <i class="fa-solid fa-align-left absolute left-3 top-3 text-neutral-400"></i>
          <textarea id="deskripsi" name="deskripsi" rows="4"
                    class="w-full pl-10 pr-3 py-2 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                    required>{{ barang[3] if barang else '' }}</textarea>
        </div>
      </div>

      <!-- Foto Produk -->
      <div>
        <label class="block text-sm font-medium text-neutral-700 mb-1">Foto Produk</label>

        <!-- Preview -->
        {% set preview = url_for('static', filename='img/products/barang_' ~ barang[0] ~ '.png') %}
        <div class="flex items-start gap-4">
          <img id="imgPreview" src="{{ preview }}" alt="Preview"
               class="w-32 h-32 object-contain rounded border border-neutral-200 bg-neutral-50 p-1"
               onerror="this.style.display='none'"/>

          <!-- Dropzone / file input -->
          <label for="foto"
                 class="flex-1 border-2 border-dashed border-neutral-300 rounded-lg p-4 text-center cursor-pointer hover:border-red-400 transition">
            <i class="fa-regular fa-image text-2xl mb-2 text-neutral-500"></i>
            <div class="text-sm text-neutral-600">Tarik & letakkan gambar di sini atau <span class="text-red-600 font-medium">pilih file</span></div>
            <div class="text-xs text-neutral-500 mt-1">png, jpg, jpeg, webp • maks ±5MB</div>
            <input id="foto" name="foto" type="file" accept="image/*" class="hidden" />
          </label>
        </div>
      </div>

      <button type="submit"
              class="w-full bg-red-600 text-white py-2.5 rounded-lg font-medium hover:bg-red-700 transition flex items-center justify-center gap-2">
        <i class="fa-solid fa-floppy-disk"></i> Simpan Perubahan
      </button>

      <a href="{{ url_for('menuAdmin', roleMenu='kelolaBarang') }}"
         class="block text-center w-full bg-neutral-200 text-neutral-800 py-2.5 rounded-lg hover:bg-neutral-300 transition">
        Batal
      </a>
    </form>
  </div>

  <script>
    // live preview
    const input = document.getElementById('foto');
    const img   = document.getElementById('imgPreview');
    if (input) {
      input.addEventListener('change', e => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        img.src = url;
        img.style.display = 'block';
      });
    }
  </script>
</body>
</html>
